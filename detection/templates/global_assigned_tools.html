<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>All Assigned Tools</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 p-6">

<div class="max-w-7xl mx-auto">

    <!-- Header -->
    <div class="flex items-center justify-between mb-6">
        <h1 class="text-3xl font-bold text-gray-800">All Assigned Tools</h1>
        <a href="{% url 'dashboard' %}"
           class="px-5 py-2 bg-green-500 text-white font-semibold rounded-lg shadow hover:bg-green-600 transition">
            Dashboard
        </a>
    </div>

    <!-- Filters Card -->
    <div class="bg-white shadow rounded-lg p-5 mb-6">
        <form method="get" class="flex flex-wrap gap-4 items-end">
            <!-- Service Station -->
            <div class="flex flex-col">
                <label class="text-gray-700 font-medium">Service Station</label>
                <select name="station_id" class="border rounded px-3 py-2 focus:ring-2 focus:ring-blue-400">
                    <option value="">All</option>
                    {% for s in stations %}
                    <option value="{{ s.id }}" {% if filters.station_id == s.id|stringformat:"s" %}selected{% endif %}>
                        {{ s.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Unit -->
            <div class="flex flex-col">
                <label class="text-gray-700 font-medium">Unit</label>
                <select name="unit_id" class="border rounded px-3 py-2 focus:ring-2 focus:ring-blue-400">
                    <option value="">All</option>
                    {% for u in units %}
                    <option value="{{ u.id }}" {% if filters.unit_id == u.id|stringformat:"s" %}selected{% endif %}>
                        {{ u.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Tray -->
            <div class="flex flex-col">
                <label class="text-gray-700 font-medium">Tray</label>
                <select name="tray_id" class="border rounded px-3 py-2 focus:ring-2 focus:ring-blue-400">
                    <option value="">All</option>
                    {% for t in trays %}
                    <option value="{{ t.id }}" {% if filters.tray_id == t.id|stringformat:"s" %}selected{% endif %}>
                        {{ t.tray_name }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Tool ID -->
            <div class="flex flex-col">
                <label class="text-gray-700 font-medium">Tool ID</label>
                <input type="text" name="tool_id" value="{{ filters.tool_id }}"
                       class="border rounded px-3 py-2 focus:ring-2 focus:ring-blue-400" placeholder="Tool ID">
            </div>

            <!-- Tool Name -->
            <div class="flex flex-col">
                <label class="text-gray-700 font-medium">Tool Name</label>
                <input type="text" name="tool_name" value="{{ filters.tool_name }}"
                       class="border rounded px-3 py-2 focus:ring-2 focus:ring-blue-400" placeholder="Tool Name">
            </div>

            <div class="flex gap-2">
                <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded shadow hover:bg-blue-600 transition">
                    Filter
                </button>
                <a href="{% url 'global_assigned_tools' %}" class="px-4 py-2 bg-gray-300 rounded shadow hover:bg-gray-400 transition">
                    Reset
                </a>
            </div>
        </form>
    </div>

    <!-- Assigned Tools Table -->
    <div class="bg-white shadow rounded-lg overflow-x-auto">
        <table class="min-w-full text-sm border-collapse">
            <thead class="bg-gray-200 text-gray-700 sticky top-0">
            <tr>
                <th class="px-4 py-2 border">Service Station</th>
                <th class="px-4 py-2 border">Unit</th>
                <th class="px-4 py-2 border">Tray</th>
                <th class="px-4 py-2 border">Tool ID</th>
                <th class="px-4 py-2 border">Tool Name</th>
                <th class="px-4 py-2 border text-center">Assigned Qty</th>
                <th class="px-4 py-2 border">Assigned By</th>
                <th class="px-4 py-2 border">Remarks</th>
                <th class="px-4 py-2 border">Assigned At</th>
            </tr>
            </thead>
            <tbody>
            {% for tt in tray_tools %}
            <tr class="hover:bg-gray-50">
                <td class="border px-3 py-2">{{ tt.tray.unit.station.name }}</td>
                <td class="border px-3 py-2">{{ tt.tray.unit.name }}</td>
                <td class="border px-3 py-2">{{ tt.tray.tray_name }}</td>
                <td class="border px-3 py-2">{{ tt.inventory.tool.tool_id }}</td>
                <td class="border px-3 py-2">{{ tt.inventory.tool.tool_name }}</td>
                <td class="border px-3 py-2 text-center font-semibold">{{ tt.assigned_quantity }}</td>
                <td class="border px-3 py-2">
                    {% if tt.assigned_by %}{{ tt.assigned_by.username }}{% else %}—{% endif %}
                </td>
                <td class="border px-3 py-2">{{ tt.remarks|default:"—" }}</td>
                <td class="border px-3 py-2">{{ tt.created_at|date:"Y-m-d H:i" }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="9" class="text-center text-gray-500 py-4">
                    No tools assigned.
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
</body>
</html>